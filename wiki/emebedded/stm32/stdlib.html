<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>stm32 标准固件库 | CS Wiki</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="shachi 的 CS 知识库">
    
    <link rel="preload" href="/wiki/assets/css/0.styles.40ef89a5.css" as="style"><link rel="preload" href="/wiki/assets/js/app.6005c093.js" as="script"><link rel="preload" href="/wiki/assets/js/2.4b7299de.js" as="script"><link rel="preload" href="/wiki/assets/js/53.96ed2bb8.js" as="script"><link rel="prefetch" href="/wiki/assets/js/10.023c6faa.js"><link rel="prefetch" href="/wiki/assets/js/11.f71b8eb3.js"><link rel="prefetch" href="/wiki/assets/js/12.0e6853b3.js"><link rel="prefetch" href="/wiki/assets/js/13.e0d914e3.js"><link rel="prefetch" href="/wiki/assets/js/14.8bdf7c13.js"><link rel="prefetch" href="/wiki/assets/js/15.9e0345c7.js"><link rel="prefetch" href="/wiki/assets/js/16.a1d1e6c3.js"><link rel="prefetch" href="/wiki/assets/js/17.58c9759b.js"><link rel="prefetch" href="/wiki/assets/js/18.a135b98c.js"><link rel="prefetch" href="/wiki/assets/js/19.b404a248.js"><link rel="prefetch" href="/wiki/assets/js/20.dcb264c7.js"><link rel="prefetch" href="/wiki/assets/js/21.938790b5.js"><link rel="prefetch" href="/wiki/assets/js/22.2613edb8.js"><link rel="prefetch" href="/wiki/assets/js/23.014c43a0.js"><link rel="prefetch" href="/wiki/assets/js/24.b38bddd1.js"><link rel="prefetch" href="/wiki/assets/js/25.5db6c161.js"><link rel="prefetch" href="/wiki/assets/js/26.a0e63e72.js"><link rel="prefetch" href="/wiki/assets/js/27.c3efab24.js"><link rel="prefetch" href="/wiki/assets/js/28.f71e96f2.js"><link rel="prefetch" href="/wiki/assets/js/29.7f5d8683.js"><link rel="prefetch" href="/wiki/assets/js/3.6d633953.js"><link rel="prefetch" href="/wiki/assets/js/30.31775b12.js"><link rel="prefetch" href="/wiki/assets/js/31.9103ea9d.js"><link rel="prefetch" href="/wiki/assets/js/32.edd6a0fb.js"><link rel="prefetch" href="/wiki/assets/js/33.33c23cb6.js"><link rel="prefetch" href="/wiki/assets/js/34.fa89b974.js"><link rel="prefetch" href="/wiki/assets/js/35.578c57c3.js"><link rel="prefetch" href="/wiki/assets/js/36.61a4611a.js"><link rel="prefetch" href="/wiki/assets/js/37.35f00b52.js"><link rel="prefetch" href="/wiki/assets/js/38.56c36766.js"><link rel="prefetch" href="/wiki/assets/js/39.ed160d8b.js"><link rel="prefetch" href="/wiki/assets/js/4.2e33d51d.js"><link rel="prefetch" href="/wiki/assets/js/40.dd849684.js"><link rel="prefetch" href="/wiki/assets/js/41.0a126ce9.js"><link rel="prefetch" href="/wiki/assets/js/42.f055cc8b.js"><link rel="prefetch" href="/wiki/assets/js/43.ce48b1bc.js"><link rel="prefetch" href="/wiki/assets/js/44.500b5a4d.js"><link rel="prefetch" href="/wiki/assets/js/45.73aaa5c9.js"><link rel="prefetch" href="/wiki/assets/js/46.5ec1f340.js"><link rel="prefetch" href="/wiki/assets/js/47.1bd50fbc.js"><link rel="prefetch" href="/wiki/assets/js/48.39997210.js"><link rel="prefetch" href="/wiki/assets/js/49.3336d241.js"><link rel="prefetch" href="/wiki/assets/js/5.5b3fd24d.js"><link rel="prefetch" href="/wiki/assets/js/50.e2bfaa49.js"><link rel="prefetch" href="/wiki/assets/js/51.f2603124.js"><link rel="prefetch" href="/wiki/assets/js/52.521181ca.js"><link rel="prefetch" href="/wiki/assets/js/54.0e345e97.js"><link rel="prefetch" href="/wiki/assets/js/55.8af9a828.js"><link rel="prefetch" href="/wiki/assets/js/56.e97b21d9.js"><link rel="prefetch" href="/wiki/assets/js/57.64b3d1c4.js"><link rel="prefetch" href="/wiki/assets/js/58.2c7d3f71.js"><link rel="prefetch" href="/wiki/assets/js/59.6cbe62a0.js"><link rel="prefetch" href="/wiki/assets/js/6.3b848e60.js"><link rel="prefetch" href="/wiki/assets/js/60.7eda6d97.js"><link rel="prefetch" href="/wiki/assets/js/61.78598666.js"><link rel="prefetch" href="/wiki/assets/js/62.dc469974.js"><link rel="prefetch" href="/wiki/assets/js/63.7ca244a4.js"><link rel="prefetch" href="/wiki/assets/js/64.d4c4d0d6.js"><link rel="prefetch" href="/wiki/assets/js/65.5a26ec0e.js"><link rel="prefetch" href="/wiki/assets/js/7.c67aa8fa.js"><link rel="prefetch" href="/wiki/assets/js/8.431ae0d7.js"><link rel="prefetch" href="/wiki/assets/js/9.d2107a17.js">
    <link rel="stylesheet" href="/wiki/assets/css/0.styles.40ef89a5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/wiki/" class="home-link router-link-active"><img src="/wiki/favicon.ico" alt="CS Wiki" class="logo"> <span class="site-name can-hide">CS Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/wiki/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/wiki/archives/" class="nav-link">
  归档
</a></div><div class="nav-item"><a href="/wiki/c/" class="nav-link">
  C
</a></div><div class="nav-item"><a href="/wiki/cpp/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="/wiki/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          理论
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/data-structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  数据库
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  编译原理
</a></li></ul></li><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/tools/vim.html" class="nav-link">
  Vim
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/Makefile.html" class="nav-link">
  Makefile
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/shell.html" class="nav-link">
  shell
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  正则表达式
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/git.html" class="nav-link">
  git
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/gdb.html" class="nav-link">
  gdb
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/CMake.html" class="nav-link">
  CMake
</a></li><li class="dropdown-subitem"><a href="https://github.com/chunni98/learn-python-with-lxf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Python3
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="嵌入式" class="dropdown-title"><span class="title">嵌入式</span> <span class="arrow down"></span></button> <button type="button" aria-label="嵌入式" class="mobile-dropdown-title"><span class="title">嵌入式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/" class="nav-link">
  x86汇编
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/sqlite3.html" class="nav-link">
  sqlite3
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/stm32/" class="nav-link router-link-active">
  stm32
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/collections.html" class="nav-link">
  问题集
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/learn-arm.html" class="nav-link">
  ARM 体系结构
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/driver/" class="nav-link">
  Linux 内核驱动
</a></li></ul></div></div><div class="nav-item"><a href="https://chunni98.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/wiki/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/wiki/archives/" class="nav-link">
  归档
</a></div><div class="nav-item"><a href="/wiki/c/" class="nav-link">
  C
</a></div><div class="nav-item"><a href="/wiki/cpp/" class="nav-link">
  C++
</a></div><div class="nav-item"><a href="/wiki/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机基础" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          理论
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/data-structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  操作系统
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  数据库
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  编译原理
</a></li></ul></li><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/wiki/tools/vim.html" class="nav-link">
  Vim
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/Makefile.html" class="nav-link">
  Makefile
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/shell.html" class="nav-link">
  shell
</a></li><li class="dropdown-subitem"><a href="/wiki/" class="nav-link">
  正则表达式
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/git.html" class="nav-link">
  git
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/gdb.html" class="nav-link">
  gdb
</a></li><li class="dropdown-subitem"><a href="/wiki/tools/CMake.html" class="nav-link">
  CMake
</a></li><li class="dropdown-subitem"><a href="https://github.com/chunni98/learn-python-with-lxf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Python3
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="嵌入式" class="dropdown-title"><span class="title">嵌入式</span> <span class="arrow down"></span></button> <button type="button" aria-label="嵌入式" class="mobile-dropdown-title"><span class="title">嵌入式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/wiki/" class="nav-link">
  x86汇编
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/sqlite3.html" class="nav-link">
  sqlite3
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/stm32/" class="nav-link router-link-active">
  stm32
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/collections.html" class="nav-link">
  问题集
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/learn-arm.html" class="nav-link">
  ARM 体系结构
</a></li><li class="dropdown-item"><!----> <a href="/wiki/emebedded/driver/" class="nav-link">
  Linux 内核驱动
</a></li></ul></div></div><div class="nav-item"><a href="https://chunni98.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/wiki/emebedded/stm32/" aria-current="page" class="sidebar-link">stm32 学习</a></li><li><a href="/wiki/emebedded/stm32/jxkj.html" class="sidebar-link">stm32 江科大自动协教程笔记</a></li><li><a href="/wiki/emebedded/stm32/1.html" class="sidebar-link">stm32（一）</a></li><li><a href="/wiki/emebedded/stm32/2.html" class="sidebar-link">FreeRTOS</a></li><li><a href="/wiki/emebedded/stm32/stdlib.html" aria-current="page" class="active sidebar-link">stm32 标准固件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/wiki/emebedded/stm32/stdlib.html#_1-时钟控制" class="sidebar-link">1 时钟控制</a></li><li class="sidebar-sub-header"><a href="/wiki/emebedded/stm32/stdlib.html#_2-gpio-配置" class="sidebar-link">2 GPIO 配置</a></li><li class="sidebar-sub-header"><a href="/wiki/emebedded/stm32/stdlib.html#afio-配置" class="sidebar-link">AFIO 配置</a></li><li class="sidebar-sub-header"><a href="/wiki/emebedded/stm32/stdlib.html#exti-配置" class="sidebar-link">EXTI 配置</a></li><li class="sidebar-sub-header"><a href="/wiki/emebedded/stm32/stdlib.html#nvic-配置" class="sidebar-link">NVIC 配置</a></li><li class="sidebar-sub-header"><a href="/wiki/emebedded/stm32/stdlib.html#定时器" class="sidebar-link">定时器</a></li></ul></li><li><a href="/wiki/emebedded/stm32/fs.html" class="sidebar-link">fs stm32（一）</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>一般来说，结构体里的参数，都会有一个单独的函数可以进行更改。</p> <h2 id="_1-时钟控制"><a href="#_1-时钟控制" class="header-anchor">#</a> 1 时钟控制</h2> <h3 id="_1-1-rcc-apb2-外设时钟控制"><a href="#_1-1-rcc-apb2-外设时钟控制" class="header-anchor">#</a> 1.1 RCC APB2 外设时钟控制</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/**
  * @brief  Enables or disables the High Speed APB (APB2) peripheral clock.
  * @param  RCC_APB2Periph: specifies the APB2 peripheral to gates its clock.
  *   This parameter can be any combination of the following values:
  *     @arg RCC_APB2Periph_AFIO, RCC_APB2Periph_GPIOA, RCC_APB2Periph_GPIOB,
  *          RCC_APB2Periph_GPIOC, RCC_APB2Periph_GPIOD, RCC_APB2Periph_GPIOE,
  *          RCC_APB2Periph_GPIOF, RCC_APB2Periph_GPIOG, RCC_APB2Periph_ADC1,
  *          RCC_APB2Periph_ADC2, RCC_APB2Periph_TIM1, RCC_APB2Periph_SPI1,
  *          RCC_APB2Periph_TIM8, RCC_APB2Periph_USART1, RCC_APB2Periph_ADC3,
  *          RCC_APB2Periph_TIM15, RCC_APB2Periph_TIM16, RCC_APB2Periph_TIM17,
  *          RCC_APB2Periph_TIM9, RCC_APB2Periph_TIM10, RCC_APB2Periph_TIM11
  * @param  NewState: new state of the specified peripheral clock.
  *   This parameter can be: ENABLE or DISABLE.
  * @retval None
  */</span>
<span class="token keyword">void</span> <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> RCC_AHBPeriph<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">RCC_AHBPeriphClockCmd</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> RCC_AHBPeriph<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> RCC_APB2Periph<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> RCC_APB1Periph<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_1-2-rcc-ahb-外设时钟控制"><a href="#_1-2-rcc-ahb-外设时钟控制" class="header-anchor">#</a> 1.2 RCC AHB 外设时钟控制</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">RCC_AHBPeriphClockCmd</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> RCC_AHBPeriph<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_1-3-rcc-apb1-外设时钟控制"><a href="#_1-3-rcc-apb1-外设时钟控制" class="header-anchor">#</a> 1.3 RCC APB1 外设时钟控制</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> RCC_APB1Periph<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_2-gpio-配置"><a href="#_2-gpio-配置" class="header-anchor">#</a> 2 GPIO 配置</h2> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/**
  * @brief  Initializes the GPIOx peripheral according to the specified
  *         parameters in the GPIO_InitStruct.
  * @param  GPIOx: where x can be (A..G) to select the GPIO peripheral.
  * @param  GPIO_InitStruct: pointer to a GPIO_InitTypeDef structure that
  *         contains the configuration information for the specified GPIO peripheral.
  * @retval None
  */</span>
  <span class="token comment">// 用结构体的参数初始化 GPIO。</span>
<span class="token keyword">void</span> <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> GPIO_InitTypeDef<span class="token operator">*</span> GPIO_InitStruct<span class="token punctuation">)</span>
<span class="token comment">// 复位 GPIO</span>
<span class="token keyword">void</span> <span class="token function">GPIO_DeInit</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 复位 AFIO</span>
<span class="token keyword">void</span> <span class="token function">GPIO_AFIODeInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>GPIO_InitTypedef 定义如下：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/**
  * @brief  GPIO Init structure definition
  */</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
  <span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">;</span>             <span class="token comment">/*!&lt; Specifies the GPIO pins to be configured.
                                      This parameter can be any value of @ref GPIO_pins_define */</span>

  GPIOSpeed_TypeDef GPIO_Speed<span class="token punctuation">;</span>  <span class="token comment">/*!&lt; Specifies the speed for the selected pins.
                                      This parameter can be a value of @ref GPIOSpeed_TypeDef */</span>

  GPIOMode_TypeDef GPIO_Mode<span class="token punctuation">;</span>    <span class="token comment">/*!&lt; Specifies the operating mode for the selected pins.
                                      This parameter can be a value of @ref GPIOMode_TypeDef */</span>
<span class="token punctuation">}</span>GPIO_InitTypeDef<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{</span> GPIO_Mode_AIN <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">,</span>            <span class="token comment">// Analog In 模拟输入</span>
  GPIO_Mode_IN_FLOATING <span class="token operator">=</span> <span class="token number">0x04</span><span class="token punctuation">,</span>   <span class="token comment">// 浮空输入</span>
  GPIO_Mode_IPD <span class="token operator">=</span> <span class="token number">0x28</span><span class="token punctuation">,</span>           <span class="token comment">// in pull down 下拉输入</span>
  GPIO_Mode_IPU <span class="token operator">=</span> <span class="token number">0x48</span><span class="token punctuation">,</span>           <span class="token comment">// in pull up 上拉输入</span>
  GPIO_Mode_Out_OD <span class="token operator">=</span> <span class="token number">0x14</span><span class="token punctuation">,</span>        <span class="token comment">// out open drain 开漏输出</span>
  GPIO_Mode_Out_PP <span class="token operator">=</span> <span class="token number">0x10</span><span class="token punctuation">,</span>        <span class="token comment">// out push pull 通用推挽输出</span>
  GPIO_Mode_AF_OD <span class="token operator">=</span> <span class="token number">0x1C</span><span class="token punctuation">,</span>         <span class="token comment">// Atl open drain 复用开漏</span>
  GPIO_Mode_AF_PP <span class="token operator">=</span> <span class="token number">0x18</span>          <span class="token comment">// Atl push pull 复用推挽</span>
<span class="token punctuation">}</span>GPIOMode_TypeDef<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{</span>
  GPIO_Speed_10MHz <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
  GPIO_Speed_2MHz<span class="token punctuation">,</span>
  GPIO_Speed_50MHz
<span class="token punctuation">}</span>GPIOSpeed_TypeDef<span class="token punctuation">;</span>

<span class="token comment">/** @defgroup GPIO_pins_define
  * @{
  */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_0</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0001</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 0 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_1</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0002</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 1 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_2</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0004</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 2 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_3</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0008</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 3 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_4</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0010</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 4 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_5</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0020</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 5 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_6</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0040</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 6 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_7</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0080</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 7 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_8</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0100</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 8 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_9</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0200</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 9 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_10</span>                <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0400</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 10 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_11</span>                <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0800</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 11 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_12</span>                <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x1000</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 12 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_13</span>                <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x2000</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 13 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_14</span>                <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x4000</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 14 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_15</span>                <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x8000</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; Pin 15 selected */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_Pin_All</span>               <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0xFFFF</span><span class="token punctuation">)</span>  </span><span class="token comment">/*!&lt; All pins selected */</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="_2-1-gpio-初始化"><a href="#_2-1-gpio-初始化" class="header-anchor">#</a> 2.1 GPIO 初始化</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// GPIO 外设复位</span>
<span class="token keyword">void</span> <span class="token function">GPIO_DeInit</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// AFI 外设复位</span>
<span class="token keyword">void</span> <span class="token function">GPIO_AFIODeInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 用结构体参数初始化 GPIO口</span>
<span class="token keyword">void</span> <span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> GPIO_InitTypeDef<span class="token operator">*</span> GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 给 GPIO 结构体一个默认值</span>
<span class="token keyword">void</span> <span class="token function">GPIO_StructInit</span><span class="token punctuation">(</span>GPIO_InitTypeDef<span class="token operator">*</span> GPIO_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-2-gpio读写"><a href="#_2-2-gpio读写" class="header-anchor">#</a> 2.2 GPIO读写</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// 读取输入数据寄存器某一个端口的输入值</span>
<span class="token class-name">uint8_t</span> <span class="token function">GPIO_ReadInputDataBit</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 读取整个输入寄存器</span>
<span class="token class-name">uint16_t</span> <span class="token function">GPIO_ReadInputData</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 读取输出寄存器的某一个位</span>
<span class="token class-name">uint8_t</span> <span class="token function">GPIO_ReadOutputDataBit</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 读取整个输出寄存器</span>
<span class="token class-name">uint16_t</span> <span class="token function">GPIO_ReadOutputData</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 把指定端口设置为高电平。</span>
<span class="token keyword">void</span> <span class="token function">GPIO_SetBits</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 把指定端口设置为低电平。</span>
<span class="token keyword">void</span> <span class="token function">GPIO_ResetBits</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Bit Val 指定写入的数据值</span>
<span class="token comment">// Bit_RESET 清除端口值，置低电平</span>
<span class="token comment">// Bit_SET  置低电平</span>
<span class="token keyword">void</span> <span class="token function">GPIO_WriteBit</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">,</span> BitAction BitVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 同时对 16 个端口进入写操作</span>
<span class="token comment">// 指定写到输出寄存器的值。</span>
<span class="token keyword">void</span> <span class="token function">GPIO_Write</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> PortVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="afio-配置"><a href="#afio-配置" class="header-anchor">#</a> AFIO 配置</h2> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// 复位 AFIO 外设，清除 AFIO 外设所有配置。</span>
<span class="token keyword">void</span> <span class="token function">GPIO_AFIODeInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 锁定某引脚的配置，防止意外更改</span>
<span class="token keyword">void</span> <span class="token function">GPIO_PinLockConfig</span><span class="token punctuation">(</span>GPIO_TypeDef<span class="token operator">*</span> GPIOx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置 AFIO 的事件输出功能</span>
<span class="token keyword">void</span> <span class="token function">GPIO_EventOutputConfig</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> GPIO_PortSource<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> GPIO_PinSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">GPIO_EventOutputCmd</span><span class="token punctuation">(</span>FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 进行引脚重映射</span>
<span class="token comment">// GPIO_Remap 重映射的方式</span>
<span class="token comment">// NewState 新的状态</span>
<span class="token keyword">void</span> <span class="token function">GPIO_PinRemapConfig</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> GPIO_Remap<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置 AFIO 的数据选择器，选择想要的中断引脚</span>
<span class="token comment">/**
  * @brief  Selects the GPIO pin used as EXTI Line.选择 GPIO 引脚作为外部中断线
  * @param  GPIO_PortSource: selects the GPIO port to be used as source for EXTI lines. 设置某个 GPIO 外设作为外部中断源
  *   This parameter can be GPIO_PortSourceGPIOx where x can be (A..G).
  * @param  GPIO_PinSource: specifies the EXTI line to be configured. 指定要配置的外部中断线。
  *   This parameter can be GPIO_PinSourcex where x can be (0..15).
  * @retval None
  */</span>
<span class="token keyword">void</span> <span class="token function">GPIO_EXTILineConfig</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> GPIO_PortSource<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> GPIO_PinSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 以太网相关</span>
<span class="token keyword">void</span> <span class="token function">GPIO_ETH_MediaInterfaceConfig</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> GPIO_ETH_MediaInterface<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="exti-配置"><a href="#exti-配置" class="header-anchor">#</a> EXTI 配置</h2> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// 把 EXTI 配置都清除，恢复成上电默认</span>
<span class="token keyword">void</span> <span class="token function">EXTI_DeInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据结构体参数配置 EXTI 外设</span>
<span class="token comment">/**
  * @brief  Initializes the EXTI peripheral according to the specified
  *         parameters in the EXTI_InitStruct.
  * @param  EXTI_InitStruct: pointer to a EXTI_InitTypeDef structure
  *         that contains the configuration information for the EXTI peripheral.
  * @retval None
  */</span>
<span class="token comment">/**
  * @brief  EXTI Init Structure definition
  */</span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
  <span class="token class-name">uint32_t</span> EXTI_Line<span class="token punctuation">;</span>               <span class="token comment">/*!&lt; Specifies the EXTI lines to be enabled or disabled.
                                         This parameter can be any combination of @ref EXTI_Lines */</span>

  EXTIMode_TypeDef EXTI_Mode<span class="token punctuation">;</span>       <span class="token comment">/*!&lt; Specifies the mode for the EXTI lines.
                                         This parameter can be a value of @ref EXTIMode_TypeDef */</span>

  EXTITrigger_TypeDef EXTI_Trigger<span class="token punctuation">;</span> <span class="token comment">/*!&lt; Specifies the trigger signal active edge for the EXTI lines.
                                         This parameter can be a value of @ref EXTIMode_TypeDef */</span>

  FunctionalState EXTI_LineCmd<span class="token punctuation">;</span>     <span class="token comment">/*!&lt; Specifies the new state of the selected EXTI lines.
                                         This parameter can be set either to ENABLE or DISABLE */</span>
<span class="token punctuation">}</span>EXTI_InitTypeDef<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{</span>
  EXTI_Mode_Interrupt <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token comment">// 中断</span>
  EXTI_Mode_Event <span class="token operator">=</span> <span class="token number">0x04</span>      <span class="token comment">// 事件</span>
<span class="token punctuation">}</span>EXTIMode_TypeDef<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{</span>
  EXTI_Trigger_Rising <span class="token operator">=</span> <span class="token number">0x08</span><span class="token punctuation">,</span>     <span class="token comment">// 上升沿触发</span>
  EXTI_Trigger_Falling <span class="token operator">=</span> <span class="token number">0x0C</span><span class="token punctuation">,</span>    <span class="token comment">// 下降沿触发</span>
  EXTI_Trigger_Rising_Falling <span class="token operator">=</span> <span class="token number">0x10</span>  <span class="token comment">//双边沿触发</span>
<span class="token punctuation">}</span>EXTITrigger_TypeDef<span class="token punctuation">;</span>


<span class="token keyword">void</span> <span class="token function">EXTI_Init</span><span class="token punctuation">(</span>EXTI_InitTypeDef<span class="token operator">*</span> EXTI_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 给 EXTI 结构体一个默认值</span>
<span class="token keyword">void</span> <span class="token function">EXTI_StructInit</span><span class="token punctuation">(</span>EXTI_InitTypeDef<span class="token operator">*</span> EXTI_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 软件触发外部中断，参数指定一个中断线</span>
<span class="token keyword">void</span> <span class="token function">EXTI_GenerateSWInterrupt</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> EXTI_Line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取指定标志位的值，看是否被置 1</span>
FlagStatus <span class="token function">EXTI_GetFlagStatus</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> EXTI_Line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 对置 1 的标志位进行清除</span>
<span class="token keyword">void</span> <span class="token function">EXTI_ClearFlag</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> EXTI_Line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 有的在置标志位后会触发中断</span>
<span class="token comment">// 在中断函数内查看中断标志位</span>
ITStatus <span class="token function">EXTI_GetITStatus</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> EXTI_Line<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 在中断函数内清除置 1 的中断挂起标志位</span>
<span class="token keyword">void</span> <span class="token function">EXTI_ClearITPendingBit</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> EXTI_Line<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h2 id="nvic-配置"><a href="#nvic-配置" class="header-anchor">#</a> NVIC 配置</h2> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// 中断分组</span>
<span class="token comment">/**
  * @brief  Configures the priority grouping: pre-emption priority and subpriority.
  * @param  NVIC_PriorityGroup: specifies the priority grouping bits length.
  *   This parameter can be one of the following values:
  *     @arg NVIC_PriorityGroup_0: 0 bits for pre-emption priority
  *                                4 bits for subpriority
  *     @arg NVIC_PriorityGroup_1: 1 bits for pre-emption priority
  *                                3 bits for subpriority
  *     @arg NVIC_PriorityGroup_2: 2 bits for pre-emption priority
  *                                2 bits for subpriority
  *     @arg NVIC_PriorityGroup_3: 3 bits for pre-emption priority
  *                                1 bits for subpriority
  *     @arg NVIC_PriorityGroup_4: 4 bits for pre-emption priority
  *                                0 bits for subpriority
  * @retval None
  */</span>
<span class="token comment">// 注意：整个芯片只能用一种分组方式，该函应该数只执行一次。</span>
<span class="token keyword">void</span> <span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> NVIC_PriorityGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 根据结构体里指定的参数初始化 NVIC</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
  <span class="token class-name">uint8_t</span> NVIC_IRQChannel<span class="token punctuation">;</span>                    <span class="token comment">/*!&lt; Specifies the IRQ channel to be enabled or disabled. IRQ 通道
                                                   This parameter can be a value of @ref IRQn_Type
                                                   (For the complete STM32 Devices IRQ Channels list, please
                                                    refer to stm32f10x.h file) */</span>

  <span class="token class-name">uint8_t</span> NVIC_IRQChannelPreemptionPriority<span class="token punctuation">;</span>  <span class="token comment">/*!&lt; Specifies the pre-emption priority for the IRQ channel 抢占优先级
                                                   specified in NVIC_IRQChannel. This parameter can be a value
                                                   between 0 and 15 as described in the table @ref NVIC_Priority_Table */</span>

  <span class="token class-name">uint8_t</span> NVIC_IRQChannelSubPriority<span class="token punctuation">;</span>         <span class="token comment">/*!&lt; Specifies the subpriority level for the IRQ channel specified 响应优先级
                                                   in NVIC_IRQChannel. This parameter can be a value
                                                   between 0 and 15 as described in the table @ref NVIC_Priority_Table */</span>

  FunctionalState NVIC_IRQChannelCmd<span class="token punctuation">;</span>         <span class="token comment">/*!&lt; Specifies whether the IRQ channel defined in NVIC_IRQChannel
                                                   will be enabled or disabled.
                                                   This parameter can be set either to ENABLE or DISABLE */</span>
<span class="token punctuation">}</span> NVIC_InitTypeDef<span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token punctuation">{</span>DISABLE <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ENABLE <span class="token operator">=</span> <span class="token operator">!</span>DISABLE<span class="token punctuation">}</span> FunctionalState<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">NVIC_Init</span><span class="token punctuation">(</span>NVIC_InitTypeDef<span class="token operator">*</span> NVIC_InitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置中断向量表</span>
<span class="token keyword">void</span> <span class="token function">NVIC_SetVectorTable</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> NVIC_VectTab<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> Offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 系统低功耗配置</span>
<span class="token keyword">void</span> <span class="token function">NVIC_SystemLPConfig</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> LowPowerMode<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">SysTick_CLKSourceConfig</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> SysTick_CLKSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h2 id="定时器"><a href="#定时器" class="header-anchor">#</a> 定时器</h2> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// 恢复缺省配置</span>
<span class="token keyword">void</span> <span class="token function">TIM_DeInit</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 时基单元初始化</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
  <span class="token comment">// PSC 预分频器的值</span>
  <span class="token class-name">uint16_t</span> TIM_Prescaler<span class="token punctuation">;</span>         <span class="token comment">/*!&lt; Spekkcifies the prescaler value used to divide the TIM clock.
                                       This parameter can be a number between 0x0000 and 0xFFFF */</span>
  <span class="token comment">// 计数器模式</span>
  <span class="token class-name">uint16_t</span> TIM_CounterMode<span class="token punctuation">;</span>       <span class="token comment">/*!&lt; Specifies the counter mode.
                                       This parameter can be a value of @ref TIM_Counter_Mode */</span>
  <span class="token comment">// 周期，ARR 自动重装器的值</span>
  <span class="token class-name">uint16_t</span> TIM_Period<span class="token punctuation">;</span>            <span class="token comment">/*!&lt; Specifies the period value to be loaded into the active
                                       Auto-Reload Register at the next update event.
                                       This parameter must be a number between 0x0000 and 0xFFFF.  */</span>
  <span class="token comment">// 定时器的外部输入引脚，一般有个滤波器</span>
  <span class="token comment">// 可以过滤掉信号的抖动干扰</span>
  <span class="token comment">// 指定时钟的分频，用来设置滤波的采样频率</span>
  <span class="token comment">// 随便选择即可</span>
  <span class="token class-name">uint16_t</span> TIM_ClockDivision<span class="token punctuation">;</span>     <span class="token comment">/*!&lt; Specifies the clock division.
                                      This parameter can be a value of @ref TIM_Clock_Division_CKD */</span>
  <span class="token comment">// 重复计数器的值</span>
  <span class="token class-name">uint8_t</span> TIM_RepetitionCounter<span class="token punctuation">;</span>  <span class="token comment">/*!&lt; Specifies the repetition counter value. Each time the RCR downcounter
                                       reaches zero, an update event is generated and counting restarts
                                       from the RCR value (N).
                                       This means in PWM mode that (N+1) corresponds to:
                                          - the number of PWM periods in edge-aligned mode
                                          - the number of half PWM period in center-aligned mode
                                       This parameter must be a number between 0x00 and 0xFF.
                                       @note This parameter is valid only for TIM1 and TIM8. */</span>
<span class="token punctuation">}</span> TIM_TimeBaseInitTypeDef<span class="token punctuation">;</span>
<span class="token comment">// 注：预分频器和计数器都有 1 个数的偏差</span>
<span class="token comment">// 例如：ARR ：10000 -1</span>
<span class="token comment">//      PSC ：7200 - 1，可以定时 1 s。</span>
<span class="token comment">// ARR 和 PSC 是 16 位的寄存器，所以，最大只能设置 65535.</span>
<span class="token keyword">void</span> <span class="token function">TIM_TimeBaseInit</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_TimeBaseInitTypeDef<span class="token operator">*</span> TIM_TimeBaseInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 给结构体变量赋默认值。</span>
<span class="token keyword">void</span> <span class="token function">TIM_TimeBaseStructInit</span><span class="token punctuation">(</span>TIM_TimeBaseInitTypeDef<span class="token operator">*</span> TIM_TimeBaseInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使能计时器</span>
<span class="token comment">// NewState ENABLE or DISABLE</span>
<span class="token keyword">void</span> <span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使能中断输出信号</span>
<span class="token comment">// TIMx 选择定时器</span>
<span class="token comment">// TIM_IT 配置哪个中断输出</span>
<span class="token comment">// NEWSTATE ENABLE or DISABLE</span>
<span class="token keyword">void</span> <span class="token function">TIM_ITConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_IT<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* 时基单元的选择 */</span>
<span class="token comment">// 选择 RCC 内部时钟</span>
<span class="token keyword">void</span> <span class="token function">TIM_InternalClockConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 选择 ITRx 其他定时器的时钟（外部时钟模式1）</span>
<span class="token comment">// TIMx 选择定时器</span>
<span class="token comment">// TIM_InputTriggerSource 选择接入的其他定时器</span>
<span class="token keyword">void</span> <span class="token function">TIM_ITRxExternalClockConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_InputTriggerSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 选择 TIMx 捕获通道的时钟（外部时钟模式1）</span>
<span class="token comment">// TIM_InputTriggerSource 选择 TIx 具体的某个引脚</span>
<span class="token comment">// TIM_InputTriggerSource 输入的极性</span>
<span class="token comment">// TIM_InputTriggerSource 滤波器</span>
<span class="token keyword">void</span> <span class="token function">TIM_TIxExternalClockConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_TIxExternalCLKSource<span class="token punctuation">,</span>
                                <span class="token class-name">uint16_t</span> TIM_ICPolarity<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> ICFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 选择 ETR 外部时钟（外部时钟模式1，TRGI）</span>
<span class="token comment">// TIM_InputTriggerSource 外部触发预分频器，对 ETR 的外部时钟再提前做一个分频</span>
<span class="token comment">// TIM_ExtTRGPolarity, 极性</span>
<span class="token comment">// uint16_t ExtTRGFilter 外部触发滤波器，以一个采样频率采样 n 个点，如果 n 个点都一样，才</span>
<span class="token comment">//                        会有效输出。，可查看控制寄存器 2，11：8 位</span>

<span class="token comment">/*
  * @param  TIM_ExtTRGPolarity: The external Trigger Polarity.
  *   This parameter can be one of the following values:
  *     @arg TIM_ExtTRGPolarity_Inverted: 反向，低电平或下降沿有效
  *     @arg TIM_ExtTRGPolarity_NonInverted: 不反向，高电平或上升沿有效
  * @param  ExtTRGFilter: External Trigger Filter.
  *   This parameter must be a value between 0x00 and 0x0F
  */</span>
<span class="token keyword">void</span> <span class="token function">TIM_ETRClockMode1Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPrescaler<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPolarity<span class="token punctuation">,</span>
                             <span class="token class-name">uint16_t</span> ExtTRGFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 选择 ETR 外部时钟（外部时钟模式2）</span>
<span class="token keyword">void</span> <span class="token function">TIM_ETRClockMode2Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPrescaler<span class="token punctuation">,</span>
                             <span class="token class-name">uint16_t</span> TIM_ExtTRGPolarity<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> ExtTRGFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置 ETR 引脚的预分频器、极性、滤波器等参数。</span>
<span class="token keyword">void</span> <span class="token function">TIM_ETRConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPrescaler<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPolarity<span class="token punctuation">,</span>
                   <span class="token class-name">uint16_t</span> ExtTRGFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置预分频值。</span>
<span class="token comment">// TIM_PSCReloadMode 写入的模式</span>
<span class="token comment">// 预分频器有个缓冲器，写入的值是在更新时间发生后才有效的，写入模式可以配置是</span>
<span class="token comment">// 手动产生更新事件立即生效还是</span>
<span class="token comment">// 听从安排再更新生效</span>
<span class="token keyword">void</span> <span class="token function">TIM_PrescalerConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Prescaler<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_PSCReloadMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 改变计数器的计数模式。</span>
<span class="token comment">// TIM_CounterMode 新的计数器模式</span>
<span class="token keyword">void</span> <span class="token function">TIM_CounterModeConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_CounterMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 自动重装器预装功能配置，自己选择有预装还是没预装</span>
<span class="token keyword">void</span> <span class="token function">TIM_ARRPreloadConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 手动设置计数值</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCounter</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 给自动重装器写入一个值</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetAutoreload</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Autoreload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取当前计数器的值</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCounter</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取当前预分频器的值</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetPrescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取标志位</span>
FlagStatus <span class="token function">TIM_GetFlagStatus</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 清除标志位</span>
<span class="token keyword">void</span> <span class="token function">TIM_ClearFlag</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取中断标志位</span>
ITStatus <span class="token function">TIM_GetITStatus</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_IT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 清除中断标志位</span>
<span class="token keyword">void</span> <span class="token function">TIM_ClearITPendingBit</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_IT<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/** @defgroup TIM_Output_Compare_and_PWM_modes
  * @{
  */</span>
<span class="token comment">// 冻结模式</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OCMode_Timing</span>                  <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0000</span><span class="token punctuation">)</span></span></span>
<span class="token comment">// 相等时设置有效电平</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OCMode_Active</span>                  <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0010</span><span class="token punctuation">)</span></span></span>
<span class="token comment">// 相等时置无效电平</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OCMode_Inactive</span>                <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0020</span><span class="token punctuation">)</span></span></span>
<span class="token comment">// 相等时电平翻转</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OCMode_Toggle</span>                  <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0030</span><span class="token punctuation">)</span></span></span>
<span class="token comment">// PWM 模式 1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OCMode_PWM1</span>                    <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0060</span><span class="token punctuation">)</span></span></span>
<span class="token comment">// PWM 模式 2</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OCMode_PWM2</span>                    <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0070</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">IS_TIM_OC_MODE</span><span class="token expression"><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_Timing<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                              <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_Active<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                              <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_Inactive<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                              <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_Toggle<span class="token punctuation">)</span><span class="token operator">||</span> </span><span class="token punctuation">\</span>
                              <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_PWM1<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                              <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_PWM2<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">IS_TIM_OCM</span><span class="token expression"><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_Timing<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                          <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_Active<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                          <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_Inactive<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                          <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_Toggle<span class="token punctuation">)</span><span class="token operator">||</span> </span><span class="token punctuation">\</span>
                          <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_PWM1<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                          <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCMode_PWM2<span class="token punctuation">)</span> <span class="token operator">||</span>	</span><span class="token punctuation">\</span>
                          <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_ForcedAction_Active<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                          <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>MODE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_ForcedAction_InActive<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token comment">/**
  * @}
  */</span>
<span class="token comment">/** @defgroup TIM_Output_Compare_Polarity
  * @{
  */</span>
<span class="token comment">// 高极性，极性不翻转， REF 波形直接输出</span>
<span class="token comment">// 有效电平是高电平</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OCPolarity_High</span>                <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0000</span><span class="token punctuation">)</span></span></span>
<span class="token comment">// 有效电平为低电平</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OCPolarity_Low</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0002</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">IS_TIM_OC_POLARITY</span><span class="token expression"><span class="token punctuation">(</span>POLARITY<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>POLARITY<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCPolarity_High<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                                      <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>POLARITY<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OCPolarity_Low<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token comment">/**
  * @}
  */</span>
<span class="token comment">/** @defgroup TIM_Output_Compare_state
  * @{
  */</span>
<span class="token comment">// 失能</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OutputState_Disable</span>            <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0000</span><span class="token punctuation">)</span></span></span>
<span class="token comment">// 使能</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TIM_OutputState_Enable</span>             <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">0x0001</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">IS_TIM_OUTPUT_STATE</span><span class="token expression"><span class="token punctuation">(</span>STATE<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>STATE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OutputState_Disable<span class="token punctuation">)</span> <span class="token operator">||</span> </span><span class="token punctuation">\</span>
                                    <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>STATE<span class="token punctuation">)</span> <span class="token operator">==</span> TIM_OutputState_Enable<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token comment">/**
  * @}
  */</span>

<span class="token comment">// 输出比较配置（4 个输出比较单元）</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 设置输出比较的模式</span>
  <span class="token class-name">uint16_t</span> TIM_OCMode<span class="token punctuation">;</span>        <span class="token comment">/*!&lt; Specifies the TIM mode.
                                   This parameter can be a value of @ref TIM_Output_Compare_and_PWM_modes */</span>
  <span class="token comment">// 设置输出使能</span>
  <span class="token class-name">uint16_t</span> TIM_OutputState<span class="token punctuation">;</span>   <span class="token comment">/*!&lt; Specifies the TIM Output Compare state.
                                   This parameter can be a value of @ref TIM_Output_Compare_state */</span>

  <span class="token class-name">uint16_t</span> TIM_OutputNState<span class="token punctuation">;</span>  <span class="token comment">/*!&lt; Specifies the TIM complementary Output Compare state.
                                   This parameter can be a value of @ref TIM_Output_Compare_N_state
                                   @note This parameter is valid only for TIM1 and TIM8. */</span>
  <span class="token comment">// 设置 CCR （捕获比较寄存器），设置占空比</span>
  <span class="token class-name">uint16_t</span> TIM_Pulse<span class="token punctuation">;</span>         <span class="token comment">/*!&lt; Specifies the pulse value to be loaded into the Capture Compare Register.
                                   This parameter can be a number between 0x0000 and 0xFFFF */</span>

  <span class="token comment">// 设置输出比较的极性，有效电平</span>
  <span class="token class-name">uint16_t</span> TIM_OCPolarity<span class="token punctuation">;</span>    <span class="token comment">/*!&lt; Specifies the output polarity.
                                   This parameter can be a value of @ref TIM_Output_Compare_Polarity */</span>

  <span class="token class-name">uint16_t</span> TIM_OCNPolarity<span class="token punctuation">;</span>   <span class="token comment">/*!&lt; Specifies the complementary output polarity.
                                   This parameter can be a value of @ref TIM_Output_Compare_N_Polarity
                                   @note This parameter is valid only for TIM1 and TIM8. */</span>

  <span class="token class-name">uint16_t</span> TIM_OCIdleState<span class="token punctuation">;</span>   <span class="token comment">/*!&lt; Specifies the TIM Output Compare pin state during Idle state.
                                   This parameter can be a value of @ref TIM_Output_Compare_Idle_State
                                   @note This parameter is valid only for TIM1 and TIM8. */</span>

  <span class="token class-name">uint16_t</span> TIM_OCNIdleState<span class="token punctuation">;</span>  <span class="token comment">/*!&lt; Specifies the TIM Output Compare pin state during Idle state.
                                   This parameter can be a value of @ref TIM_Output_Compare_N_Idle_State
                                   @note This parameter is valid only for TIM1 and TIM8. */</span>
<span class="token punctuation">}</span> TIM_OCInitTypeDef<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC1Init</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC2Init</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC3Init</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC4Init</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 给输出比较结构体赋一个默认值。</span>
<span class="token keyword">void</span> <span class="token function">TIM_OCStructInit</span><span class="token punctuation">(</span>TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置强制输出模式，在运行中暂停输出波形并强制输出高或低电平</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC1Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC2Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC3Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC4Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 配置 CCR 寄存器的预装功能，也就是影子寄存器，写入的值不会立即生效，而是在更新事件后生效。</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC1Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC2Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC3Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC4Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 单独更改 CCR 寄存器值的函数，用来在运行的时候更改占空比。</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCompare1</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Compare1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCompare2</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Compare2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCompare3</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Compare3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCompare4</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Compare4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 仅高级定时器使用，输出 pwm 时需要调用，使能主输出。</span>
<span class="token keyword">void</span> <span class="token function">TIM_CtrlPWMOutputs</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ---------------------- 输入捕获 -----------------------</span>
<span class="token comment">// 初始化输入捕获单元， 4 个通道共用一个函数</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 通道</span>
  <span class="token class-name">uint16_t</span> TIM_Channel<span class="token punctuation">;</span>      <span class="token comment">/*!&lt; Specifies the TIM channel.
                                  This parameter can be a value of @ref TIM_Channel */</span>
  <span class="token comment">// 极性，边沿检测、极性选择</span>
  <span class="token class-name">uint16_t</span> TIM_ICPolarity<span class="token punctuation">;</span>   <span class="token comment">/*!&lt; Specifies the active edge of the input signal.
                                  This parameter can be a value of @ref TIM_Input_Capture_Polarity */</span>
  <span class="token comment">// 选择触发信号从哪个引脚输入</span>
  <span class="token comment">// 可以选择直连通道或者是交叉通道或者是 TRC</span>
  <span class="token class-name">uint16_t</span> TIM_ICSelection<span class="token punctuation">;</span>  <span class="token comment">/*!&lt; Specifies the input.
                                  This parameter can be a value of @ref TIM_Input_Capture_Selection */</span>
  <span class="token comment">// 分频器</span>
  <span class="token class-name">uint16_t</span> TIM_ICPrescaler<span class="token punctuation">;</span>  <span class="token comment">/*!&lt; Specifies the Input Capture Prescaler.
                                  This parameter can be a value of @ref TIM_Input_Capture_Prescaler */</span>
  <span class="token comment">// 输入捕获的滤波器，信号有噪声可以增大滤波器参数，有效避免干扰</span>
  <span class="token comment">// 可参考参考手册</span>
  <span class="token class-name">uint16_t</span> TIM_ICFilter<span class="token punctuation">;</span>     <span class="token comment">/*!&lt; Specifies the input capture filter.
                                  This parameter can be a number between 0x0 and 0xF */</span>
<span class="token punctuation">}</span> TIM_ICInitTypeDef<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ICInit</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_ICInitTypeDef<span class="token operator">*</span> TIM_ICInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//初始化输入捕获单元，可以快速配置两个通道。</span>
<span class="token keyword">void</span> <span class="token function">TIM_PWMIConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_ICInitTypeDef<span class="token operator">*</span> TIM_ICInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 给结构体赋值一个初始值</span>
<span class="token keyword">void</span> <span class="token function">TIM_ICStructInit</span><span class="token punctuation">(</span>TIM_ICInitTypeDef<span class="token operator">*</span> TIM_ICInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 选择输入触发源 TRGI</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectInputTrigger</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_InputTriggerSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//选择输出触发源 TRGO</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectOutputTrigger</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_TRGOSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 选择从模式</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectSlaveMode</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_SlaveMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 分别单独配置通道 1、2、3、4 的分频器</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetIC1Prescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ICPSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetIC2Prescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ICPSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetIC3Prescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ICPSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetIC4Prescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ICPSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 分别读取 4 个通道的 CCR。</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCapture1</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCapture2</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCapture3</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCapture4</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新:</span> <span class="time">2023/7/31 16:43:32</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/wiki/emebedded/stm32/2.html" class="prev">
        FreeRTOS
      </a></span> <span class="next"><a href="/wiki/emebedded/stm32/fs.html">
        fs stm32（一）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/wiki/assets/js/app.6005c093.js" defer></script><script src="/wiki/assets/js/2.4b7299de.js" defer></script><script src="/wiki/assets/js/53.96ed2bb8.js" defer></script>
  </body>
</html>
